<!DOCTYPE html>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <title>Streetmix - angled parking test</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <style>
    html, body {
      width: 100%;
      height: 100%;
    }

    body {
      margin: 0;
      overflow: hidden;
      background-color: #a9ccdb;
    }

    #howto {
      box-sizing: border-box;
      position: absolute;
      left: 0;
      width: 100%;
      bottom: 0;
      text-align: center;
      padding: 4em 1em;
      pointer-events: none;
      font-family: 'Roboto', sans-serif;
      color: #404040;
    }
  </style>
</head>
<body>

<div id='view'></div>
<div id='howto'>Drag left or right</div>

<script src='js/three.min.js'></script>
<script src='js/ColladaLoader.js'></script>
<script src='js/OrbitControls.js'></script>
<script src='js/hand.min.1.3.8.js'></script>

<script>
  'use strict'

  var scene
  var camera
  var renderer
  var controls
  var animation

  function init () {
    scene = new THREE.Scene()

    var container = document.getElementById('view')
    var HEIGHT = window.innerHeight
    var WIDTH = window.innerWidth

    var fieldOfView = 60
    var nearPlane = 1
    var farPlane = 2000

    camera = new THREE.OrthographicCamera(
      WIDTH / -2,
      WIDTH / 2,
      HEIGHT / 2,
      HEIGHT / -2,
      nearPlane,
      farPlane
    )

    camera.position.x = 0 // Straight on view to start
    camera.position.y = 0
    camera.position.z = 300
    camera.lookAt(new THREE.Vector3(0, 0, 0))

    renderer = new THREE.WebGLRenderer({
      alpha: true,
      antialias: true
    })
    renderer.setPixelRatio(window.devicePixelRatio || 1)
    renderer.setSize(WIDTH, HEIGHT)

    container.appendChild(renderer.domElement)

    document.addEventListener('pointerdown', onPointerDown, false)
    document.addEventListener('pointerup', onPointerUp, false)
    window.addEventListener('resize', onWindowResize, false)
  }

  function onWindowResize () {
    var HEIGHT = window.innerHeight
    var WIDTH = window.innerWidth

    camera.left = WIDTH / -2
    camera.right = WIDTH / 2
    camera.top = HEIGHT / 2
    camera.bottom = HEIGHT / -2
    camera.updateProjectionMatrix()
    renderer.setSize(WIDTH, HEIGHT)
    render()
  }

  function onPointerDown () {
    loop()
  }

  function onPointerUp () {
    endloop()
  }

  function addOrbitControls () {
    // Orbit controls
    controls = new THREE.OrbitControls(camera, renderer.domElement)
    controls.noZoom = true
    controls.noPan = true
    controls.rotateSpeed = 2.0

    // Lock to horizontal view
    controls.minPolarAngle = Math.PI / 2
    controls.maxPolarAngle = Math.PI / 2
  }

  function addLights () {
    var light = new THREE.HemisphereLight(0xffffff, 0xffffff, 1)
    scene.add(light)
  }

  function addCar () {
    var loader = new THREE.ColladaLoader()
    loader.options.convertUpAxis = true
    loader.load('data/car.dae', function (result) {
      var collada = result.scene
      collada.scale.x = collada.scale.y = collada.scale.z = 1
      collada.updateMatrix()
      scene.add(collada)
      render()
    })
  }

  function loop () {
    render()
    animation = window.requestAnimationFrame(loop)
  }

  function endloop () {
    render()
    window.cancelAnimationFrame(animation)
  }

  function render () {
    if (controls) controls.update()
    renderer.render(scene, camera)
  }

  init()
  addCar()
  addLights()
  addOrbitControls()
  render()
</script>

</body>
</html>
